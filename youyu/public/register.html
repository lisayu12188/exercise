<!DOCTYPE html>
<html>
<head lang="zh-cn">
  <meta charset="utf-8">
  <title>æ¸¸é±¼ç½‘-ç”¨ä½ çš„çœ¼ç›ğŸ‘€çœ‹ä¸–ç•Œ</title>
  <!--å¼•å…¥è§†å£-->
  <meta name="viewport" content="width=device-width,initial-scale=1,scalable=no">
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="my-css/reset.css">
  <link rel="stylesheet" type="text/css" href="my-css/register.css">
  <link rel="stylesheet" type="text/css" href="my-css/common.css">

</head>
<body>
<!--1.é¡µé¢é¡¶éƒ¨ï¼šå¯¼èˆªæ¡+æœç´¢æ¡† -->
<header>
  <div class="page-top">
    <h1><a href="index.html"><img src="images/main-logo.png"></a></h1>
    <ul>
      <li>
        <a data-toggle="modal" data-target="#myModal">ç™»é™†</a>
        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">ç”¨æˆ·ç™»å½•</h4>
              </div>
              <div class="modal-body">
                <form method="post">
                  <div class="form-group">
                    <label for="recipient-name" class="control-label">è´¦æˆ·åï¼š</label>
                    <input type="text" name="uname" class="form-control" id="recipient-name">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="control-label">å¯†ç ï¼š</label>
                    <input required type="text" name="upwd" class="form-control" id="message-text">
                  </div>
                </form>
                <div class="other-login">
                  <a href=""><span id="weibo"></span>å¾®åšç™»é™†</a>
                  <a href=""><span id="weixin"></span>å¾®ä¿¡ç™»é™†</a>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">è¿”å›</button>
                <button type="button" class="btn btn-primary">ç™»å½•</button>

              </div>
            </div>
          </div>
        </div>
        <!-- <a href=""id="weibo">å¾®åšç™»é™†</a>
        <a href=""id="weixin">å¾®ä¿¡ç™»é™†</a> -->
      </li>
      <li>
        <i>|</i>
        <a href="register.html">æ³¨å†Œ</a>
        <i>|</i>
      </li>
      
      <li id="language" class="dropdown">
        <button id="lgg-btn" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <p>è¯·é€‰æ‹©è¯­è¨€</p>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dLabel">
          <li style="display:block" data-status=1>
          <p  class="current"><img src="images/CN-flag.gif" width="25px"> CN</p>
          </li>
          <li>
          <p><img src="images/UK-flag.gif" width="25px"> En</p>
          </li >
          <li>
          <p><img src="images/JP-flag.gif" width="25px">  Jan</p>
          </li>
          <li>
          <p><img src="images/SP-flag.gif" width="25px">  Span</p>
          </li>
        </ul>
      </li>
      <li class="app">
        <i>|</i>
        <a data-status="1" style="font-weight:bold;text-decoration: underline;">ä¸‹è½½App</a>
        <p id="two-code" ><img src="images/2-code.jpg" width="100px"></p>
      </li>
    </ul>
  </div>
  <div class="search-wrapper">
    <div class="search" id="navbar">
      <ul class="nav">
        <li>
          <a href="index.html">é¦–é¡µ</a>
        </li>
        <li  >
          <a href="destination.html">ç›®çš„åœ°</a>
        </li>
        <li>
          <a href="hotel.html">é…’åº—</a>
        </li>
        <li >
          <a href="">æ™¯ç‚¹</a>
        </li>
        <li>
          <a href="food.html">ç¾é£Ÿ</a>
        </li>
        <li>
          <a href="">æ¸¸è®°</a>
        </li>
        <li>
          <a href="">æŒ‡å—</a>
        </li>
        <li>
          <a href="photos.html">æ‘„å½±</a>
        </li>
        <li>
          <a href="">å†™ç‚¹è¯„</a>
        </li>
      </ul>
      <!-- <div class="input-wrapper">
        <input type="text" name="txtSearch" placeholder="è¯·è¾“å…¥é…’åº—ã€é¤å…ã€æ™¯ç‚¹åç§°">
        <button>æŸ¥&nbsp;&nbsp;è¯¢</button>
      </div> -->
    </div>
  </div>
</header>
<!--2.ä¸»ä½“å†…å®¹ï¼šä¼šå‘˜æ³¨å†Œ-->
<section>
  <div id="register-info">
    <h3>
      <b>ä¼šå‘˜æ³¨å†Œ</b>
    </h3>
    <form method="post">
      <div>
        <label>é‚®ç®±è´¦å·ï¼š</label>
        <input required class="uemail" type="email" name="" placeholder="è¯·è¾“å…¥é‚®ç®±è´¦å·">
      </div>
      <div>
        <label>æ˜µç§°ï¼š</label>
        <input required class="uname" type="text" name="" placeholder="3-18ä½ä¸­è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿">
      </div>
      <div>
        <label>è®¾ç½®å¯†ç ï¼š</label>
        <input required class="upwd" type="password" name="" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆ6-16ä½æ•°å­—ã€å­—æ¯æˆ–å­—ç¬¦çš„ç»„åˆï¼‰">
      </div>
      <div>
        <label>ç¡®è®¤å¯†ç ï¼š</label>
        <input required class="confirm-upwd" type="password" name="" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆ6-16ä½æ•°å­—ã€å­—æ¯æˆ–å­—ç¬¦çš„ç»„åˆï¼‰">
      </div>
      <div class="id-code" >
        <label>éªŒè¯ç ï¼š</label>
        <input name="" class="id-input" type="text" name="" placeholder="è¯·è¾“å…¥éªŒè¯ç ">
        <canvas id="myCanvas" width="100px" height="50px"></canvas>
        <a href="#" id="idtxt">çœ‹ä¸æ¸…ï¼Œæ¢ä¸€å¼ </a>
      </div>
      <p style="text-align: center">
        <a  id="reg-btn" style="  background-color: green;
    color: white; font-size: 18px;border: none; padding:5px 10px;">
          åŒæ„åè®®å¹¶æ³¨å†ŒÂ®
        </a>
      </p>

      <p>
        å·²ç»æœ‰è´¦å·ï¼Ÿ<a data-toggle="modal" data-target="#myModal">ç«‹å³ç™»é™†</a>
      </p>
    </form>
    <aside>
      <h4>æ³¨å†Œä¼šå‘˜é¡»çŸ¥ï¼š</h4>
      <p> æ³¨å†Œåã€‚ã€‚ã€‚ã€‚ã€‚<p>
    </aside>
    </div>



  </div>
</section>
<!--4.é¡µé¢åº•éƒ¨-->
<footer>
  <hr>
  <p>
    <a href="">å…³äºæˆ‘ä»¬</a>
    <i>|</i>
    <a href="">æ–°é—»åŠ¨æ€</a>
    <i>|</i>
    <a href="">å·¥ä½œæœºä¼š</a>
    <i>|</i>
    <a href="">å•†åŠ¡åˆä½œ</a>
    <i>|</i>
    <a href="">ä¼šå‘˜ä¸­å¿ƒ</a>
    <i>|</i>
    <a href="">ä¸šä¸»ä¸­å¿ƒ</a>
    <i>|</i>
    <a href="">å¸¸è§é—®é¢˜</a>
    <i>|</i>
    <a href="">æ„è§åé¦ˆ</a>
    <i>|</i>
    <a href="">è”ç³»æˆ‘ä»¬</a>
    <i>|</i>
    <a href="">è¥ä¸šæ‰§ç…§</a>
  </p>
  <p>&copy; 2017 æ¸¸é±¼ç½‘ ç‰ˆæƒæ‰€æœ‰ã€‚ æ¸¸é±¼ç½‘çš„ <a href="">ä½¿ç”¨æ¡æ¬¾</a> å’Œ <a href=""> éšç§æ”¿ç­–</a>
  <br>
  *
  æ¸¸é±¼ç½‘ä¸æ˜¯æ—…è¡Œç¤¾ï¼Œä¹Ÿä¸æ˜¯æ—…æ¸¸é¢„è®¢æœåŠ¡ä»£ç†å•†ã€‚æˆ‘ä»¬æä¾›å…è´¹ã€å®¢è§‚ã€å…¬æ­£çš„æ—…æ¸¸èµ„è®¯æœåŠ¡ã€‚</p>
  <p>
  <a href="">äº¬ICPè¯080678å·</a>&nbsp;&nbsp;
  <a href="">äº¬ICPå¤‡09040564å·</a>&nbsp;&nbsp;
  <a href="">äº¬å…¬ç½‘å®‰å¤‡11010502027214å·</a>

  </p>
</footer>
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<script type="text/javascript" src="js/jquery-1.11.3.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script>
  onload=function(){
//      éšæœºç”ŸæˆéªŒè¯ç 
      var chars='';
      function changeCode() {

          var str = 'ABCDEFGHJKLMNPQRSTWXY3456789';
          var n = str.length;
          var w = 100;
          var h = 50;
          var b = 0;
          var s = 14;
          var c = document.getElementById("myCanvas");
          var ctx = c.getContext("2d");

          function x() {
              var x = parseInt(Math.random() * w);
              return x;
          }

          function y() {
              var y = parseInt(Math.random() * h);
              return y;
          }


          //console.log(i);
          function getChar() {
              var i1 = parseInt(Math.random() * n);
              return char= "" + str[i1];
          }



          function fontSize() {
              var fontSize = parseInt((Math.random() * 20) + 12) + "px";
              return fontSize + " Arial";
          }

          function getLightColor() {
              var r = parseInt((Math.random()*256)+120)
              var g = parseInt((Math.random()*256)+120)
              var b = parseInt((Math.random()*256)+120)
              //return {r,g,b}
              return "rgb(" + r + "," + g + "," + b + ")";

          }
          function getDarkColor() {
              var r = parseInt(Math.random()*120)
              var g = parseInt(Math.random() * 120)
              var b = parseInt(Math.random() * 120)
              //return {r,g,b}
              return "rgb(" + r + "," + g + "," + b + ")";

          }

          function getCircle() {
              ctx.beginPath();
              //ctx.fillStyle="#ddd";
              ctx.arc(x(), y(), 1, 0, 2 * Math.PI);
              ctx.closePath();
              ctx.fillStyle = getLightColor();
              ctx.fill();
          }

          function getLine() {
              ctx.beginPath();
              ctx.moveTo(x(), y());
              ctx.lineTo(x(), y());
              ctx.strokeStyle = getDarkColor();
              ctx.stroke();
          }

          ctx.clearRect(0,0,w,h);

          function drawChar(){
              ctx.font = fontSize()
              //var color = getColor();
              //var ctx = c.getContext("2d");
              ctx.fillStyle = getDarkColor();
              ctx.fillText(getChar(), b+=s, 40);
          }

          for (var i = 0; i < 5; i++) {
              drawChar();
              chars+=char;
          }
          //console.log(chars);
          c.style.background = getLightColor();

          for (var i = 0; i < 100; i++) {
              getCircle();
          }
          for (var i = 0; i < 5; i++) {
              getLine();
          }
      }
      changeCode();
      idtxt.onclick=function(e){
          e.preventDefault();
          changeCode();
      }
      var e=document.querySelector("#register-info .uemail");
      var n=document.querySelector("#register-info .uname");
      var p=document.querySelector("#register-info .upwd");
      var cp=document.querySelector("#register-info .confirm-upwd");
      var regbtn=document.querySelector("#reg-btn");
      var code=document.querySelector("#register-info .id-input");
      console.log(chars);
      regbtn.onclick=function() {
          if(code.value!=null){
              if (code.value === chars ) {
                  $.ajax({
                      type: "POST",
                      url: "/user/register",
                      data: {uemail: e.value, uname: n.value, upwd: p.value},
                      success: (result) => {
                          //console.log(result);
                          alert(result.msg);
//                          regbtn.setAttribute("data-toggle","modal");
//                          regbtn.setAttribute("data-target","#myModal");
                          setTimeout(function(){
                              location.href="index.html"
                          },3000)


                      }
                  });
              }
          }
      };

//      éªŒè¯ç”¨æˆ·åï¼Œå¯†ç ,é‚®ç®±,éªŒè¯ç çš„è¾“å…¥
      function isUname(){
          var unameReg=/^(\w){3,18}$/;
          if(!unameReg.test(n.value)){
              console.log("uname is wrong");
              $(n).after("<span>*æ˜µç§°å¿…é¡»æ˜¯3-18ä½ä¸­è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿</span>");
              $(n).next().css("color","red").siblings("span").remove();

          }else{
            $(n).siblings("span").remove()
          };
      }
      function isPwd(){
          var upwdReg=/^(\w){6,16}$/;
          if(!upwdReg.test(p.value)){
              $(p).after("<span>*å¯†ç å¿…é¡»æ˜¯6-16ä½æ•°å­—ã€å­—æ¯æˆ–å­—ç¬¦çš„ç»„åˆ</span>");
              $(p).next().css("color","red").siblings("span").remove()
          }else{
            $(p).siblings("span").remove()
          }
      }
      function isEmail(){
          var mailReg=/^(\w)+(\.\w+)*@(\w)+((\.\w{2,3}){1,3})$/;
          if(!mailReg.test(e.value)){
              $(e).after("<span>*é‚®ç®±æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°è¾“å…¥</span>");
              $(e).next().css("color","red").siblings("span").remove();

          }else{
            $(e).siblings("span").remove()
          };
      }
      function isCode() {
          $("#register-info").on("focus","input",function(){
              this.value="";
              $(this).css("color","#666");
          })
          code.style.color="#666";
          if(code.value!=chars){
            $(code).after("<span>*éªŒè¯ç ä¸æ­£ç¡®</span>");
              $(code).next().css("color","red").siblings("span").remove();

          }else{
            $(code).siblings("span").remove()
          };
      }
      $("#register-info").on("blur","input",function(){
          if($(this).hasClass("uname")){isUname()};
          if($(this).hasClass("upwd")){isPwd()};
          if($(this).hasClass("uemail")){isEmail()};
          if($(this).hasClass("id-input")){isCode()};


      });
      var pEle=document.createElement("p");
      $("#register-info .confirm-upwd").blur(function(){
          if(cp.value!=p.value){
              pEle.innerHTML="*ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸ä¸€è‡´ï¼Œè¯·é‡æ–°è¾“å…¥ï¼";
              pEle.style.color="red";
              cp.parentElement.appendChild(pEle);
          }
      })
      $("#register-info ").on("blur",".confirm-upwd",function(){
          if($(this).parent().children("p")) {
              cp.parentElement.removeChild(pEle);
          }

      })


  }
</script>


</body>
</html>